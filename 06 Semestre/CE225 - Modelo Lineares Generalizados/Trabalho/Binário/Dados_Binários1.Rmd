---
title: "Trabalho de dados Binários"
author: Laís Hoffmann, Simone Matsubara, Yasmin Fernandes, Willian Meira
date: '`r Sys.Date() `'
output:
  pdf_document:
    keep_tex: true
  html_document: 
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_float: yes
  word_document: default
subtitle: "Acidentes de carro"
header-includes: \usepackage[brazil]{babel}
                 \usepackage{amsmath}
                 \usepackage{float}
                 \usepackage{bm}
#csl: ABNT_UFPR_2011.csl
#bibliography: refs.bib
---
```{r, include=FALSE}
library(lattice)
library(DAAG)
library(gridExtra)
library(corrplot)
library(carData)
library(car)
library(statmod)
library(effects)
library(ROCR)
library(faraway)
library(ggplot2)
```

# 1. Base de Dados

**1.1 Descrição dos dados**

Os dados foram retirados do pacote "DAAG", sendo dados dos EUA, entre 1997-2002, de acidentes de carro relatados pela polícia nos quais há um evento prejudicial (pessoas ou propriedade) e do qual pelo menos um veículo foi rebocado.
Os dados são restritos aos ocupantes do banco da frente, incluem apenas um subconjunto das variáveis registradas e são restritos de outras maneiras também.


A base original possui uma base de dados com 26.217 observações nas 15 variáveis a seguir.

1 - **veloc**: velocidades estimadas do impacto do acidente: 1-9km/h, 10-24, 25-39, 40-54, 55+
\newline 2 - **pesos**: Pesos de observação
\newline 3 - **sobrev**: Classificação se sobreviveu ao acidente: 1 = morreu ou 0 = sobreviveu
\newline 4 - **airbag**: Se o carro possui airbag: com ou sem airbag
\newline 5 - **cinto**: uso do cinto de segurança: com ou sem cinto
\newline 6 - **frontal**: impacto do acidente: 0 = não frontal, 1 = impacto frontal
\newline 7 - **sexo**: Sexo: 0 = Feminino ou 1 = Masculino
\newline 8 - **idade**: Idade dos ocupantes do veículo
\newline 9 - **anoaci**: Ano do acidente (1997-2002)
\newline 10 - **anovei**: Ano do veículo (1953-2003)
\newline 11 - **airbagcat**: Se Airbags foram acionados: deploy, nodeploy, unavail
\newline 12 - **ocupantes**: Posição do airbag acionado: driver, pass
\newline 13 - **abfunc**: Airbag acionados: 0: Se não possuia airbag ou não foi acionado, 1: Um ou mais airbags foram acionados
\newline 14 - **grav**: Gravidade do acidente: 0:none, 1 = Possível Lesão, 2:no incapacity, 3:incapacity, 4:killed; 5:unknown, 6:prior death
\newline 15 - **numcaso**: Número do caso.

No entanto, escolhemos analisar os dados do ano do acidente de 2002 e veículos de ano 2000 e retirar as variaveis weight, abcat e caseid. 

```{r, include=FALSE}
## Carregando e ajustando a base de dados
#*********************************
data("nassCDS")
summary(nassCDS)
dados <- nassCDS
dados<-subset(dados,yearacc==2002 & yearVeh == 2000)
#selecionando covariáveis
dados <-dados[,c(-2,-9,-10,-11,-15)]
summary(dados)
#ajustando as variáveis
dados$dvcat <- as.ordered(ifelse(dados$dvcat == '1-9km/h','01-09 mph',
               ifelse(dados$dvcat == '10-24','10-24 mph',
               ifelse(dados$dvcat == '25-39','25-39 mph',
               ifelse(dados$dvcat == '40-54','40-54 mph','55+ mph')))))
dados$dead <- as.numeric(ifelse(dados$dead == 'alive',1,0))
dados$airbag <- as.numeric(ifelse(dados$airbag == 'airbag',1,0))
dados$seatbelt <- as.numeric(ifelse(dados$seatbelt == 'belted',1,0))
dados$frontal <- as.numeric(ifelse(dados$frontal == 1,1,0))
dados$sex <- as.factor(ifelse(dados$sex == 'm', 'Masc','Fem'))
dados$occRole <- as.numeric(ifelse(dados$occRole == 'driver',1,0))
dados$deploy<-as.factor(ifelse(dados$deploy == 1,'Sim','Não'))
dados$injSeverity<-as.ordered(dados$injSeverity)

names(dados)<-c('veloc','sobrev','airbag','cinto','frontal','sexo','idade','ocupantes','abfunc','grav')
str(dados)
```

# 2 Análise Descritiva

**2.1 Medidas de Resumo**
```{r, include=FALSE}
head(dados,10)
summary(dados)
summary(dados[ , c(1:8,10)])
sum(dados$abfunc == 1)
```

```{r}
summary(dados[ , c(1:8,10)])
```

**2.3 Histogramas**
```{r}
par(mfrow = c(3,3))
plot(dados$abfunc, xlab = '', ylab = '', main = 'AB Funcionou')
plot(dados$veloc, xlab = '', ylab = '', main = 'Velocidade')
plot(dados$sobrev, xlab = '', ylab = '', main = 'Sobrevivente')
plot(dados$airbag, xlab = '', ylab = '', main = 'Airbag')
plot(dados$cinto, xlab = '', ylab = '', main = 'Cinto')
plot(dados$frontal, xlab = '', ylab = '', main = 'Frontal')
plot(dados$sexo, xlab = '', ylab = '', main = 'Sexo')
plot(dados$ocupantes, xlab = '', ylab = '', main = 'Ocupante')
plot(dados$grav, xlab = '', ylab = '', main = 'Gravidade')
mtext(side=2,cex=1.3,line=-1.5,text="Proporção das variaveis",outer=TRUE)
```

**2.4 Distribuição**
```{r, include=FALSE}
g1<-ggplot(dados, aes(x=factor(abfunc), y=veloc, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('veloc')+ ylab('') +
  theme(legend.title=element_blank())

g2<-ggplot(dados, aes(x=factor(abfunc), y=sobrev, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('sobrev')+ ylab('') +
  theme(legend.title=element_blank())

g3<-ggplot(dados, aes(x=factor(abfunc), y=airbag, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('airbag')+ ylab('') +
  theme(legend.title=element_blank())

g4<-ggplot(dados, aes(x=factor(abfunc), y=frontal, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('frontal')+ ylab('') +
  theme(legend.title=element_blank())

g5<-ggplot(dados, aes(x=factor(abfunc), y=sexo, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('sexo')+ ylab('') +
  theme(legend.title=element_blank())

g6<-ggplot(dados, aes(x=factor(abfunc), y=idade, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('idade')+ ylab('') +
  theme(legend.title=element_blank())

g7<-ggplot(dados, aes(x=factor(abfunc), y=ocupantes, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('ocupantes')+ ylab('') +
  theme(legend.title=element_blank())

g8<-ggplot(dados, aes(x=factor(abfunc), y=grav, color=factor(abfunc))) + 
  geom_boxplot()+ xlab('grav')+ ylab('') +
  theme(legend.title=element_blank())
```

```{r}
grid.arrange(g1, g2, g3, g4, g5, g6, g7,g8, ncol=3, nrow=3)
```


**2.5 Análise de correlações entre covariáveis**


**2.6 Gráficos de Disperção**
```{r, include=FALSE}
dis<- scatterplotMatrix(dados[ , c(1:8,10)], col = c('Green', 'Red', 'Gray'), lwd = 3)
```

```{r}
dis
```


# 3. AJUSTE DO MODELO DE REGRESSÃO

**3.1 Ligação Logito**
```{r}
ajuste1 <- glm(abfunc ~ .,family=binomial(link='logit'),data = dados)
```

**3.2 Ligação Probito**
```{r}
ajuste2 <- glm(abfunc ~ .,family=binomial(link = 'probit'),data = dados)
```

**3.3 Ligação Complemento log-log**
```{r}
ajuste3 <- glm(abfunc ~ .,family=binomial(link='cloglog'),data = dados)
```


**3.4 Ligação Cauchy**
```{r}
ajuste4 <- glm(abfunc ~ .,family=binomial(link='cauchit'),data = dados)
```


# 4. ESCOLHA DO MODELO

```{r}
selec <- data.frame(ajuste=c('logito', 'probito', 'cloglog', 'cauchy'),
                    aic=c(AIC(ajuste1), AIC(ajuste2), AIC(ajuste3), AIC(ajuste4)),
                    logLik=c(logLik(ajuste1),logLik(ajuste2),logLik(ajuste3),logLik(ajuste4)))

selec
```

O modelo que apresentou menor AIC e maior verossimilhança foi o modelo Binomial com função de ligação C Log-Log.

# 5. ANÁLISE DO MODELO AJUSTADO SELECIONADO

**5.1 Resumo do Modelo**
```{r}
summary(ajuste4)
```

**5.2 Reajuste do Modelo**
```{r}
ajuste4.1 <- step(ajuste4, direction = "both")
summary(ajuste4.1)
```


**5.3 Análise de Resíduos**
```{r}
anova(ajuste4, ajuste4.1, test = 'Chisq')
par(mfrow=c(2,2))
plot(ajuste4.1, 1:4)
```


**5.4 Medidas de Influencia**
```{r}
influenceIndexPlot(ajuste4.1, vars=c("Cook"), main="Distância de Cook")
```

```{r}
influenceIndexPlot(ajuste4.1, vars=c("Studentized"), main="Resíduos Padronizados")
```


**5.5 Resíduos Quantílicos Aleatoriazados**


**5.7 Gráficos de Efeitos**
```{r}
plot(allEffects(ajuste4.1), type = 'response', main = '')
```


# 6. PREDIÇÃO


# 7. AVALIAÇÃO DO PODER PREDITIVO DO MODELO

**7.1 Divisão da Base de dados**

**7.2 Ponto de Corte**

**7.3 Sensibilidade e Especificidade**

**7.4 Curva ROC**

**7.5 Outra Alternativa de validação**

# 8. REFERÊNCIAS









  
  
#


